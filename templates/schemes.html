<!doctype html>
<html lang="{{ CURRENT_LANG or 'en' }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Government Schemes for Farmers — AgroSathi</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f8fafc; font-family: Inter, system-ui, sans-serif; }
    .schemes-card { max-width:1100px; margin:40px auto; background:#fff; border-radius:12px; padding:24px; box-shadow:0 6px 20px rgba(2,6,23,0.06); }
    .scheme-item { border-left:4px solid #198754; padding:14px; margin-bottom:14px; border-radius:6px; }
    .scheme-meta { font-size:0.9rem; color:#6b7280; }
    .apply-btn { min-width:110px; }
  </style>
</head>
<body>
  <div class="container">
    <a href="{{ url_for('home') }}" class="btn btn-outline-secondary mt-4">← Back</a>
    <div class="schemes-card mt-3">
      <h3 class="mb-2">Government Schemes for Farmers (India)</h3>
      <p class="text-muted">Curated list of national schemes. Click a scheme to visit official page or view details.</p>

      <div class="row g-2 mb-3">
        <div class="col-md-4">
          <input id="filterMinistry" class="form-control" placeholder="Filter by ministry (e.g., Agriculture)"/>
        </div>
        <div class="col-md-4">
          <input id="filterQ" class="form-control" placeholder="Search title / description"/>
        </div>
        <div class="col-md-4 d-flex gap-2">
          <button id="btnFilter" class="btn btn-success">Filter</button>
          <button id="btnReset" class="btn btn-outline-secondary">Reset</button>
        </div>
      </div>

      <div id="schemesList">
        <!-- dynamic -->
      </div>

      <p class="muted-note mt-3 text-muted small">Data shown is from local dataset. Edit <code>data/schemes_india.json</code> to add more. Later we can wire live sources.</p>
    </div>
  </div>

<script>
  async function loadSchemes(ministry='', q='') {
    const params = new URLSearchParams();
    if (ministry) params.append('ministry', ministry);
    if (q) params.append('q', q);
    const resp = await fetch('/api/schemes?' + params.toString());
    const data = await resp.json();
    const list = document.getElementById('schemesList');
    list.innerHTML = '';
    if (!data.schemes || data.schemes.length === 0) {
      list.innerHTML = '<div class="alert alert-info">No schemes found.</div>';
      return;
    }
    for (const s of data.schemes) {
      const el = document.createElement('div');
      el.className = 'scheme-item';
      el.innerHTML = `
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <h5>${s.title}</h5>
            <div class="scheme-meta">${s.short_desc || ''} • <strong>${s.ministry || ''}</strong></div>
            <div class="mt-2"><small class="text-muted">Updated: ${s.last_updated || '—'}</small></div>
            <p class="mt-2">${s.benefits ? '<strong>Benefits:</strong> ' + s.benefits : ''}</p>
            <p class="mb-0"><small><strong>Eligibility:</strong> ${s.eligibility || '—'}</small></p>
          </div>
          <div class="text-end">
            ${s.apply_url ? `<a class="btn btn-outline-success apply-btn" href="${s.apply_url}" target="_blank" rel="noopener">Official</a>` : ''}
            <button class="btn btn-sm btn-secondary mt-2" onclick="showDetails('${s.id}')">Details</button>
          </div>
        </div>
      `;
      list.appendChild(el);
    }
  }

  function showDetails(id) {
    alert('Open details for ' + id + '. You can implement a modal to show full scheme info.');
  }

  document.getElementById('btnFilter').addEventListener('click', () => {
    loadSchemes(document.getElementById('filterMinistry').value.trim(), document.getElementById('filterQ').value.trim());
  });
  document.getElementById('btnReset').addEventListener('click', () => {
    document.getElementById('filterMinistry').value = '';
    document.getElementById('filterQ').value = '';
    loadSchemes();
  });

  // initial load
  loadSchemes();
</script>
</body>
</html>
